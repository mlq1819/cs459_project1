#ifndef DEBUG
#define DEBUG true
#endif
#include <stdio.h>
#include <string.h>
#include <unistd.h>
#include <iostream>
#include <cstdlib>
#include <stdlib.h>
#include <string>

using namespace std;

int main(int argc, char** argv){
#if DEBUG
cout << "In prgm1_stack_exploit:\n[";
for(int i=0; i<argc; i++){
	if(i>0)
		cout << ", ";
	cout << argv[i];
}
cout << "]" << endl;
#endif
	string prog_name  = "./program1.cpp";
	size_t length = prog_name.length() + ((unsigned int) argc-1);
#if DEBUG
cout << "\tlength=" << length << endl;
#endif
	for(int i=1; i<argc; i++){
		length += strlen(argv[i]) + 1;
#if DEBUG
cout << "\t" << argv[i] << " : length=" << length << endl;
#endif
	}
	char * args = (char *) malloc(sizeof(char) * length);
	unsigned int index;
	for(index=0; index<prog_name.length(); index++){
		args[index] = prog_name.c_str()[index];
#if DEBUG
cout << "\t\targs[" << index << "] = " << args[index] << endl;
#endif
	}
	for(unsigned int j=1; j<argc; j++){
		args[index] = ' ';
#if DEBUG
cout << "\t\targs[" << index << "] = " << args[index] << endl;
#endif
		index++;
		for(unsigned int i=0; i<strlen(argv[j]) && index<length; i++){
			args[index] = argv[j][i];
#if DEBUG
cout << "\t\targs[" << index << "] = " << args[index] << endl;
#endif
			index++;
		}
	}
#if DEBUG
cout << "\"" << args << "\"" << endl;
#endif
	int toReturn = system(args);
	free(args);
	return toReturn;
}